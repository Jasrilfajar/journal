<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Journal</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .main-content {
            padding: 30px;
        }

        .form-container {
            background: #f8f9ff;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
        }

        .form-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }

        .input-group input,
        .input-group select,
        .input-group textarea {
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .input-group input:focus,
        .input-group select:focus,
        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .textarea-full {
            grid-column: 1 / -1;
        }

        .button-container {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 25px;
        }

        .btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #545b62;
            transform: translateY(-2px);
        }

        .btn-export {
            background: #28a745;
            color: white;
        }

        .btn-export:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            border-top: 4px solid #667eea;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .profit { color: #28a745; }
        .loss { color: #dc3545; }

        .trades-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
        }

        .trades-header {
            background: #f8f9fa;
            padding: 20px;
            border-bottom: 1px solid #dee2e6;
        }

        .trades-header h3 {
            margin-bottom: 15px;
            color: #333;
        }

        .filter-container {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .filter-container input,
        .filter-container select {
            padding: 8px 12px;
            border: 1px solid #dee2e6;
            border-radius: 5px;
        }

        .trades-table {
            width: 100%;
            border-collapse: collapse;
        }

        .trades-table th,
        .trades-table td {
            padding: 15px;
            text-align: left;
            border-bottom: 1px solid #dee2e6;
        }

        .trades-table th {
            background: #f8f9fa;
            font-weight: 600;
            color: #333;
            position: sticky;
            top: 0;
        }

        .trades-table tr:hover {
            background: #f8f9ff;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .btn-small {
            padding: 5px 10px;
            font-size: 12px;
            border-radius: 4px;
        }

        .btn-edit {
            background: #ffc107;
            color: #212529;
        }

        .btn-delete {
            background: #dc3545;
            color: white;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
        }

        .modal-content {
            background: white;
            margin: 5% auto;
            padding: 0;
            width: 90%;
            max-width: 600px;
            border-radius: 10px;
            overflow: hidden;
        }

        .modal-header {
            background: #667eea;
            color: white;
            padding: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .close {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
        }

        @media (max-width: 768px) {
            .form-group {
                grid-template-columns: 1fr;
            }
            
            .filter-container {
                flex-direction: column;
            }
            
            .trades-table {
                font-size: 14px;
            }
            
            .trades-table th,
            .trades-table td {
                padding: 10px 8px;
            }
        }

        .import-export {
            margin-top: 20px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .file-input {
            margin: 10px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìà Trading Journal</h1>
            <p>Kelola dan analisis trading Anda dengan mudah</p>
        </div>

        <div class="main-content">
            <!-- Form Input Trade -->
            <div class="form-container">
                <h3>üìù Input Trade Baru</h3>
                <form id="tradeForm">
                    <div class="form-group">
                        <div class="input-group">
                            <label for="date">Tanggal</label>
                            <input type="datetime-local" id="date" required>
                        </div>
                        <div class="input-group">
                            <label for="pair">Pair/Symbol</label>
                            <input type="text" id="pair" placeholder="EUR/USD, BTC/USDT, AAPL" required>
                        </div>
                        <div class="input-group">
                            <label for="type">Tipe Trade</label>
                            <select id="type" required>
                                <option value="">Pilih Tipe</option>
                                <option value="BUY">BUY</option>
                                <option value="SELL">SELL</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="entry">Entry Price</label>
                            <input type="number" id="entry" step="0.00001" placeholder="0.00000" required>
                        </div>
                        <div class="input-group">
                            <label for="exit">Exit Price</label>
                            <input type="number" id="exit" step="0.00001" placeholder="0.00000" required>
                        </div>
                        <div class="input-group">
                            <label for="size">Size/Lot</label>
                            <input type="number" id="size" step="0.01" placeholder="1.00" required>
                        </div>
                        <div class="input-group">
                            <label for="pnl">P&L (USD)</label>
                            <input type="number" id="pnl" step="0.01" placeholder="0.00" required>
                        </div>
                        <div class="input-group">
                            <label for="commission">Komisi/Fee</label>
                            <input type="number" id="commission" step="0.01" placeholder="0.00">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group textarea-full">
                            <label for="notes">Catatan/Strategi</label>
                            <textarea id="notes" rows="3" placeholder="Tulis analisis, strategi, atau catatan penting..."></textarea>
                        </div>
                    </div>
                    <div class="button-container">
                        <button type="submit" class="btn btn-primary">üíæ Simpan Trade</button>
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">üîÑ Reset Form</button>
                    </div>
                </form>
            </div>

            <!-- Statistik -->
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-number" id="totalTrades">0</div>
                    <div class="stat-label">Total Trades</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number profit" id="totalPnL">$0.00</div>
                    <div class="stat-label">Total P&L</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="winRate">0%</div>
                    <div class="stat-label">Win Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgWin">$0.00</div>
                    <div class="stat-label">Avg Win</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="avgLoss">$0.00</div>
                    <div class="stat-label">Avg Loss</div>
                </div>
            </div>

            <!-- Daftar Trades -->
            <div class="trades-container">
                <div class="trades-header">
                    <h3>üìä Daftar Trades</h3>
                    <div class="filter-container">
                        <input type="text" id="searchPair" placeholder="Cari pair...">
                        <select id="filterType">
                            <option value="">Semua Tipe</option>
                            <option value="BUY">BUY</option>
                            <option value="SELL">SELL</option>
                        </select>
                        <select id="filterResult">
                            <option value="">Semua Hasil</option>
                            <option value="profit">Profit</option>
                            <option value="loss">Loss</option>
                        </select>
                        <button class="btn btn-export btn-small" onclick="exportToCSV()">üì• Export CSV</button>
                    </div>
                </div>
                <div style="overflow-x: auto;">
                    <table class="trades-table">
                        <thead>
                            <tr>
                                <th>Tanggal</th>
                                <th>Pair</th>
                                <th>Tipe</th>
                                <th>Entry</th>
                                <th>Exit</th>
                                <th>Size</th>
                                <th>P&L</th>
                                <th>Komisi</th>
                                <th>Net</th>
                                <th>Aksi</th>
                            </tr>
                        </thead>
                        <tbody id="tradesTableBody">
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Import/Export -->
            <div class="import-export">
                <h3>üíæ Import/Export Data</h3>
                <div class="button-container">
                    <input type="file" id="importFile" accept=".json" class="file-input">
                    <button class="btn btn-secondary" onclick="importData()">üì§ Import JSON</button>
                    <button class="btn btn-export" onclick="exportData()">üì• Export JSON</button>
                    <button class="btn btn-secondary" onclick="clearAllData()" style="background: #dc3545;">üóëÔ∏è Clear All Data</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Edit Trade -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Edit Trade</h3>
                <span class="close" onclick="closeEditModal()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="editTradeForm">
                    <div class="form-group">
                        <div class="input-group">
                            <label for="editDate">Tanggal</label>
                            <input type="datetime-local" id="editDate" required>
                        </div>
                        <div class="input-group">
                            <label for="editPair">Pair/Symbol</label>
                            <input type="text" id="editPair" required>
                        </div>
                        <div class="input-group">
                            <label for="editType">Tipe Trade</label>
                            <select id="editType" required>
                                <option value="BUY">BUY</option>
                                <option value="SELL">SELL</option>
                            </select>
                        </div>
                        <div class="input-group">
                            <label for="editEntry">Entry Price</label>
                            <input type="number" id="editEntry" step="0.00001" required>
                        </div>
                        <div class="input-group">
                            <label for="editExit">Exit Price</label>
                            <input type="number" id="editExit" step="0.00001" required>
                        </div>
                        <div class="input-group">
                            <label for="editSize">Size/Lot</label>
                            <input type="number" id="editSize" step="0.01" required>
                        </div>
                        <div class="input-group">
                            <label for="editPnl">P&L (USD)</label>
                            <input type="number" id="editPnl" step="0.01" required>
                        </div>
                        <div class="input-group">
                            <label for="editCommission">Komisi/Fee</label>
                            <input type="number" id="editCommission" step="0.01">
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="input-group textarea-full">
                            <label for="editNotes">Catatan/Strategi</label>
                            <textarea id="editNotes" rows="3"></textarea>
                        </div>
                    </div>
                    <div class="button-container">
                        <button type="submit" class="btn btn-primary">üíæ Update Trade</button>
                        <button type="button" class="btn btn-secondary" onclick="closeEditModal()">‚ùå Batal</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        let trades = [];
        let editingTradeId = null;

        // Load data saat halaman dimuat
        document.addEventListener('DOMContentLoaded', function() {
            loadTrades();
            updateStats();
            renderTrades();
            
            // Set default datetime to now
            document.getElementById('date').value = new Date().toISOString().slice(0, 16);
            
            // Event listeners untuk filter
            document.getElementById('searchPair').addEventListener('input', filterTrades);
            document.getElementById('filterType').addEventListener('change', filterTrades);
            document.getElementById('filterResult').addEventListener('change', filterTrades);
        });

        // Form submission
        document.getElementById('tradeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const trade = {
                id: Date.now().toString(),
                date: document.getElementById('date').value,
                pair: document.getElementById('pair').value.toUpperCase(),
                type: document.getElementById('type').value,
                entry: parseFloat(document.getElementById('entry').value),
                exit: parseFloat(document.getElementById('exit').value),
                size: parseFloat(document.getElementById('size').value),
                pnl: parseFloat(document.getElementById('pnl').value),
                commission: parseFloat(document.getElementById('commission').value) || 0,
                notes: document.getElementById('notes').value
            };
            
            trades.push(trade);
            saveTrades();
            updateStats();
            renderTrades();
            resetForm();
            
            alert('‚úÖ Trade berhasil disimpan!');
        });

        // Edit trade form submission
        document.getElementById('editTradeForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const tradeIndex = trades.findIndex(t => t.id === editingTradeId);
            if (tradeIndex !== -1) {
                trades[tradeIndex] = {
                    id: editingTradeId,
                    date: document.getElementById('editDate').value,
                    pair: document.getElementById('editPair').value.toUpperCase(),
                    type: document.getElementById('editType').value,
                    entry: parseFloat(document.getElementById('editEntry').value),
                    exit: parseFloat(document.getElementById('editExit').value),
                    size: parseFloat(document.getElementById('editSize').value),
                    pnl: parseFloat(document.getElementById('editPnl').value),
                    commission: parseFloat(document.getElementById('editCommission').value) || 0,
                    notes: document.getElementById('editNotes').value
                };
                
                saveTrades();
                updateStats();
                renderTrades();
                closeEditModal();
                
                alert('‚úÖ Trade berhasil diupdate!');
            }
        });

        function resetForm() {
            document.getElementById('tradeForm').reset();
            document.getElementById('date').value = new Date().toISOString().slice(0, 16);
        }

        function saveTrades() {
            try {
                const data = JSON.stringify(trades);
                // Karena tidak bisa menggunakan localStorage, kita simpan ke variabel
                // Dalam implementasi nyata, Anda bisa save ke file
                console.log('Data trades:', data);
            } catch (error) {
                console.error('Error saving trades:', error);
            }
        }

        function loadTrades() {
            try {
                // Dalam implementasi nyata, load dari file atau database
                // Untuk demo, kita gunakan data contoh
                if (trades.length === 0) {
                    trades = [
                        {
                            id: '1',
                            date: '2024-01-15T10:30',
                            pair: 'EUR/USD',
                            type: 'BUY',
                            entry: 1.0850,
                            exit: 1.0920,
                            size: 1.0,
                            pnl: 70,
                            commission: 2,
                            notes: 'Breakout strategy'
                        },
                        {
                            id: '2',
                            date: '2024-01-16T14:15',
                            pair: 'GBP/USD',
                            type: 'SELL',
                            entry: 1.2650,
                            exit: 1.2600,
                            size: 0.5,
                            pnl: 25,
                            commission: 1.5,
                            notes: 'Support/Resistance'
                        }
                    ];
                }
            } catch (error) {
                console.error('Error loading trades:', error);
                trades = [];
            }
        }

        function updateStats() {
            const totalTrades = trades.length;
            const totalPnL = trades.reduce((sum, trade) => sum + trade.pnl - trade.commission, 0);
            const winners = trades.filter(trade => trade.pnl > 0).length;
            const winRate = totalTrades > 0 ? (winners / totalTrades * 100) : 0;
            
            const winningTrades = trades.filter(trade => trade.pnl > 0);
            const losingTrades = trades.filter(trade => trade.pnl < 0);
            
            const avgWin = winningTrades.length > 0 ? 
                winningTrades.reduce((sum, trade) => sum + trade.pnl, 0) / winningTrades.length : 0;
            const avgLoss = losingTrades.length > 0 ? 
                losingTrades.reduce((sum, trade) => sum + trade.pnl, 0) / losingTrades.length : 0;

            document.getElementById('totalTrades').textContent = totalTrades;
            document.getElementById('totalPnL').textContent = `$${totalPnL.toFixed(2)}`;
            document.getElementById('totalPnL').className = totalPnL >= 0 ? 'stat-number profit' : 'stat-number loss';
            document.getElementById('winRate').textContent = `${winRate.toFixed(1)}%`;
            document.getElementById('avgWin').textContent = `$${avgWin.toFixed(2)}`;
            document.getElementById('avgLoss').textContent = `$${avgLoss.toFixed(2)}`;
        }

        function renderTrades() {
            const tbody = document.getElementById('tradesTableBody');
            tbody.innerHTML = '';
            
            const sortedTrades = [...trades].sort((a, b) => new Date(b.date) - new Date(a.date));
            
            sortedTrades.forEach(trade => {
                const row = document.createElement('tr');
                const netPnL = trade.pnl - trade.commission;
                const resultClass = netPnL >= 0 ? 'profit' : 'loss';
                
                row.innerHTML = `
                    <td>${new Date(trade.date).toLocaleString('id-ID')}</td>
                    <td><strong>${trade.pair}</strong></td>
                    <td><span style="color: ${trade.type === 'BUY' ? '#28a745' : '#dc3545'}">${trade.type}</span></td>
                    <td>${trade.entry.toFixed(5)}</td>
                    <td>${trade.exit.toFixed(5)}</td>
                    <td>${trade.size}</td>
                    <td class="${trade.pnl >= 0 ? 'profit' : 'loss'}">$${trade.pnl.toFixed(2)}</td>
                    <td>$${trade.commission.toFixed(2)}</td>
                    <td class="${resultClass}"><strong>$${netPnL.toFixed(2)}</strong></td>
                    <td class="action-buttons">
                        <button class="btn btn-small btn-edit" onclick="editTrade('${trade.id}')">‚úèÔ∏è</button>
                        <button class="btn btn-small btn-delete" onclick="deleteTrade('${trade.id}')">üóëÔ∏è</button>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function filterTrades() {
            const searchTerm = document.getElementById('searchPair').value.toLowerCase();
            const typeFilter = document.getElementById('filterType').value;
            const resultFilter = document.getElementById('filterResult').value;
            
            const rows = document.querySelectorAll('#tradesTableBody tr');
            
            rows.forEach(row => {
                const pair = row.cells[1].textContent.toLowerCase();
                const type = row.cells[2].textContent;
                const netPnL = parseFloat(row.cells[8].textContent.replace('$', ''));
                
                let showRow = true;
                
                if (searchTerm && !pair.includes(searchTerm)) {
                    showRow = false;
                }
                
                if (typeFilter && type !== typeFilter) {
                    showRow = false;
                }
                
                if (resultFilter) {
                    if (resultFilter === 'profit' && netPnL <= 0) {
                        showRow = false;
                    } else if (resultFilter === 'loss' && netPnL >= 0) {
                        showRow = false;
                    }
                }
                
                row.style.display = showRow ? '' : 'none';
            });
        }

        function editTrade(id) {
            const trade = trades.find(t => t.id === id);
            if (!trade) return;
            
            editingTradeId = id;
            
            document.getElementById('editDate').value = trade.date;
            document.getElementById('editPair').value = trade.pair;
            document.getElementById('editType').value = trade.type;
            document.getElementById('editEntry').value = trade.entry;
            document.getElementById('editExit').value = trade.exit;
            document.getElementById('editSize').value = trade.size;
            document.getElementById('editPnl').value = trade.pnl;
            document.getElementById('editCommission').value = trade.commission;
            document.getElementById('editNotes').value = trade.notes;
            
            document.getElementById('editModal').style.display = 'block';
        }

        function closeEditModal() {
            document.getElementById('editModal').style.display = 'none';
            editingTradeId = null;
        }

        function deleteTrade(id) {
            if (confirm('‚ö†Ô∏è Yakin ingin menghapus trade ini?')) {
                trades = trades.filter(trade => trade.id !== id);
                saveTrades();
                updateStats();
                renderTrades();
                alert('‚úÖ Trade berhasil dihapus!');
            }
        }

        function exportToCSV() {
            const headers = ['Tanggal', 'Pair', 'Tipe', 'Entry', 'Exit', 'Size', 'P&L', 'Komisi', 'Net', 'Catatan'];
            const csvContent = [
                headers.join(','),
                ...trades.map(trade => [
                    `"${new Date(trade.date).toLocaleString('id-ID')}"`,
                    trade.pair,
                    trade.type,
                    trade.entry,
                    trade.exit,
                    trade.size,
                    trade.pnl,
                    trade.commission,
                    (trade.pnl - trade.commission).toFixed(2),
                    `"${trade.notes.replace(/"/g, '""')}"`
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `trading_journal_${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function exportData() {
            const dataStr = JSON.stringify(trades, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `trading_journal_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            window.URL.revokeObjectURL(url);
        }

        function importData() {
            const fileInput = document.getElementById('importFile');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('‚ö†Ô∏è Pilih file JSON terlebih dahulu!');
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const importedTrades = JSON.parse(e.target.result);
                    
                    if (Array.isArray(importedTrades)) {
                        if (confirm('‚ö†Ô∏è Import akan mengganti semua data yang ada. Lanjutkan?')) {
                            trades = importedTrades;
                            saveTrades();
                            updateStats();
                            renderTrades();
                            alert('‚úÖ Data berhasil diimport!');
                            fileInput.value = '';
                        }
                    } else {
                        alert('‚ùå Format file tidak valid!');
                    }
                } catch (error) {
                    alert('‚ùå Error membaca file: ' + error.message);
                }
            };
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('‚ö†Ô∏è PERINGATAN: Ini akan menghapus SEMUA data trading Anda! Yakin ingin melanjutkan?')) {
                if (confirm('‚ö†Ô∏è Terakhir konfirmasi - Semua data akan hilang permanen!')) {
                    trades = [];
                    saveTrades();
                    updateStats();
                    renderTrades();
                    alert('‚úÖ Semua data telah dihapus!');
                }
            }
        }

        // Close modal when clicking outside
        window.onclick = function(event) {
            const modal = document.getElementById('editModal');
            if (event.target === modal) {
                closeEditModal();
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl/Cmd + S to save current form
            if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                e.preventDefault();
                if (document.getElementById('editModal').style.display === 'block') {
                    document.getElementById('editTradeForm').dispatchEvent(new Event('submit'));
                } else {
                    document.getElementById('tradeForm').dispatchEvent(new Event('submit'));
                }
            }
            
            // Escape to close modal
            if (e.key === 'Escape') {
                closeEditModal();
            }
        });

        // Auto-calculate P&L suggestion (optional feature)
        function calculatePnLSuggestion() {
            const type = document.getElementById('type').value;
            const entry = parseFloat(document.getElementById('entry').value);
            const exit = parseFloat(document.getElementById('exit').value);
            const size = parseFloat(document.getElementById('size').value);
            
            if (type && entry && exit && size) {
                let pnl = 0;
                if (type === 'BUY') {
                    pnl = (exit - entry) * size * 100000; // Assuming forex pip value
                } else if (type === 'SELL') {
                    pnl = (entry - exit) * size * 100000;
                }
                
                // This is just a rough calculation, user should input actual P&L
                console.log('Suggested P&L:', pnl.toFixed(2));
            }
        }

        // Add event listeners for P&L calculation
        ['type', 'entry', 'exit', 'size'].forEach(id => {
            document.getElementById(id).addEventListener('input', calculatePnLSuggestion);
        });

        // Performance metrics calculation
        function calculateAdvancedStats() {
            if (trades.length === 0) return;
            
            const profits = trades.filter(t => t.pnl > 0).map(t => t.pnl - t.commission);
            const losses = trades.filter(t => t.pnl < 0).map(t => t.pnl - t.commission);
            
            const totalProfit = profits.reduce((sum, p) => sum + p, 0);
            const totalLoss = Math.abs(losses.reduce((sum, l) => sum + l, 0));
            
            const profitFactor = totalLoss > 0 ? totalProfit / totalLoss : totalProfit > 0 ? Infinity : 0;
            
            // Maximum Drawdown calculation
            let peak = 0;
            let maxDrawdown = 0;
            let runningTotal = 0;
            
            trades.forEach(trade => {
                runningTotal += trade.pnl - trade.commission;
                if (runningTotal > peak) {
                    peak = runningTotal;
                }
                const currentDrawdown = peak - runningTotal;
                if (currentDrawdown > maxDrawdown) {
                    maxDrawdown = currentDrawdown;
                }
            });
            
            console.log('Advanced Stats:', {
                profitFactor: profitFactor.toFixed(2),
                maxDrawdown: maxDrawdown.toFixed(2),
                totalProfit: totalProfit.toFixed(2),
                totalLoss: totalLoss.toFixed(2)
            });
        }

        // Call advanced stats calculation when updating stats
        const originalUpdateStats = updateStats;
        updateStats = function() {
            originalUpdateStats();
            calculateAdvancedStats();
        };
    </script>
</body>
</html>